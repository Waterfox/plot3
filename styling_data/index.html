<!DOCTYPE html>
<html>
	<head>
		<title>Plot3 Prototype Style</title>

		<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="stylesheets/global_style.css" />
		<link rel="stylesheet" href="stylesheets/style.css" />

		<link rel="stylesheet" href="stylesheets/sankeyStyle.css" />

		<script src="javascript/jquery.js"></script>
		<script src="javascript/d3.v2.js"></script>
		<script src="javascript/sankey.js"></script>

		<script type="text/javascript">
			function get_random_color() {
				var letters = '0123456789ABCDEF'.split('');
				var color = '#';
				for (var i = 0; i < 6; i++ ) {
					color += letters[Math.round(Math.random() * 15)];
				}
				return color;
			}

			$(document).ready(function() {
				var rand_color = get_random_color().toString()

				$('#title_num').css('color', rand_color);
				$('.emph').css('color', rand_color);

				$('article a').css('color', rand_color);
				$('article a').hover(function() {
					$(this).css('color', '#666');
				}, function() {
					$(this).css('color', rand_color);
				});

				$('footer a').css('color', rand_color);
				$('footer a').hover(function() {
					$(this).css('color', '#666');
				}, function() {
					$(this).css('color', rand_color);
				});

				$('.textbox').focus(function() {
					$(this).css('border-color', rand_color);
				});
				$('.textbox').blur(function() {
					$(this).css('border-color', '#111');
				});

				$('.textarea').focus(function() {
					$(this).css('border-color', rand_color);
				});
				$('.textarea').blur(function() {
					$(this).css('border-color', '#111');
				});
			});
		</script>
	</head>
	<body>
		<div class="wrapper">
			<header>
				<h1 id="header_title"><a href="index.html">Plot<span id="title_num">3</a></span></h1>

				<nav>
					<ul>
						<li><a href="settings.html">Settings</a></li>
						<li><a href="contact.html">Contact</a></li>
						<li><a href="#" class="emph">Log Out</a></li>
					</ul>
				</nav>
			</header>
			<article>
				<h1>John's Database</h1> <input type="button" class="button" style="float: right;" value="Add Data" onmouseup="window.location = 'addnew.html'" />

				<div id="chart">
				</div>

				<script>
					var container_width = $('article').width();
					var container_height = $(window).height();

					var margin = {top: 10, right: 1, bottom: 6, left: 1},
					    width = container_width - margin.left - margin.right,
					    height = (container_height-221) - margin.top - margin.bottom;

					$('#chart').css('height', height.toString() + 'px');

					var d3_colorset = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf'];

					var fade = function (d){
							if (d.id >0){
							var rect = d3.select(this);
							rect.attr("fill-opacity",0.7)
							.attr("cursor","crosshair")
							.style("stroke-width",2.0);}
							else{
							var rect = d3.select(this);
							rect.attr("cursor","move");
							}
					  	};
						
					var unfade = function(){
							var rect = d3.select(this);
							rect.attr("fill-opacity",0.9)
							.style("stroke-width",1.0);
					  	};

					var hold = function(d){	
							if (d.id >0){
							var rect = d3.select(this);
							rect.attr("fill-opacity",0.7)
							.attr("cursor","crosshair")
							.style("stroke-width",2.0);}
							};
							
					d3.scale.colorset = function() {
						return d3.scale.ordinal().range(d3_colorset);
						};		
						
					var formatNumber = d3.format(",.0f"),
					    format = function(d) { return formatNumber(d) + " data sets"; },
					    color = d3.scale.colorset();

					var svg = d3.select("#chart").append("svg")
					    .attr("width", width + margin.left + margin.right)
					    .attr("height", height + margin.top + margin.bottom)
					  .append("g")
					    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					var sankey = d3.sankey()
					    .nodeWidth(20)
					    .nodePadding(10)
					    .size([width, height]);

					var path = sankey.link();

					//This is where Json used to be 

					lifenodes={"nodes": [{"name": "friends", "id": ["", ""]}, {"name": "sal", "id": [""]}, {"name": "hockey scores", "id": [24001]}, {"name": "performance", "id": [""]}, {"name": "didur", "id": [23001]}, {"name": "cats", "id": ["", ""]}, {"name": "pengals", "id": ["", ""]}, {"name": "mcpoot", "id": [""]}, {"name": "activities", "id": [22001]}, {"name": "pooter", "id": [""]}, {"name": "stocks", "id": [21001]}], "links": [{"source": 0, "target": 1, "value": 1}, {"source": 0, "target": 3, "value": 1}, {"source": 1, "target": 2, "value": 1}, {"source": 3, "target": 4, "value": 1}, {"source": 5, "target": 6, "value": 2}, {"source": 6, "target": 7, "value": 1}, {"source": 6, "target": 9, "value": 1}, {"source": 7, "target": 8, "value": 1}, {"source": 9, "target": 10, "value": 1}]}

					sankey
					  .nodes(lifenodes.nodes)
					  .links(lifenodes.links)
					  .layout(32);

					var link = svg.append("g").selectAll(".link")
					  .data(lifenodes.links)
					.enter().append("path")
					  .attr("class", "link")
					  .attr("d", path)
					  .style("stroke-width", function(d) { return Math.max(1, d.dy); })
					  .sort(function(a, b) { return b.dy - a.dy; });

					link.append("title")
					  .text(function(d) { return d.source.name + " â†’ " + d.target.name + "\n" + format(d.value); });

					var node = svg.append("g").selectAll(".node")
					  .data(lifenodes.nodes)
						.enter().append("g")
					  .attr("class", "node")
					  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
					  .on("click", clickbot )
					  .on("mouseover",fade)
					  .on("mouseout",unfade)
					  .on("mousedown",hold)
					  .call(d3.behavior.drag()
					  .origin(function(d) { return d; })
					  .on("dragstart", function() { this.parentNode.appendChild(this); })
					  .on("drag", dragmove));

					node.append("rect")
					  .attr("height", function(d) { return d.dy; })
					  .attr("width", sankey.nodeWidth())
					  .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
					  .style("stroke", function(d) { return d3.rgb(d.color).darker(3); })
					  //.style("stroke-width", function(d) { if (d.id[0] > 0){return 1.0;} else {return 1.0;}; })
					  .on("mouseover",fade)
					  .on("mouseout",unfade)
					  .on("mousedown",hold)
					.append("title")
					  .text(function(d) { return d.name + "\n" + format(d.value); });
					  

					node.append("text")
					  .attr("x", -6)
					  .attr("y", function(d) { return d.dy / 2; })
					  .attr("dy", ".35em")
					  .attr("text-anchor", "end")
					  .attr("transform", null)
					  .text(function(d) { return d.name; })
					.filter(function(d) { return d.x < width / 2; })
					  .attr("x", 6 + sankey.nodeWidth())
					  .attr("text-anchor", "start");

					function clickbot(d){
					if (d.id[0] > 0){
					address = ["/"+d.id[0]].join()
					parent.window.location.href = address;}}

					  
					function dragmove(d) {
					d3.select(this).attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
					sankey.relayout();
					link.attr("d", path);
					}
				</script>
			</article>
			<footer>
				Copyright {x} 2012. Some filler content. Some more filler content. <a href="#">Link</a>.
			</footer>
		</div>
	</body>
</html>